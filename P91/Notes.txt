--------------------------------------------------------------------------------

Unless otherwise specified, a triangle in this note is assumed to be
a right-angled triangle.

--------------------------------------------------------------------------------

The question asks us to count the number of RA triangle which satisfy the
following criteria:

1. Every vertices of the triangle lies on a 50x50 integral grid
2. One vertex is on the origin

We will call an RA triangle with all vertices on an integral grid *embeddable*
and an embeddable RA triangle with one vertex on origin *good*.

--------------------------------------------------------------------------------

Is it true that if a RA triangle is embeddable on an integral grid,
then the triangle has an rational area?

An embeddable triangle has at most two edges aligned with the grid.
If it has two edges aligned with the grid, both edges must be of integral length.
The two edges are at right angle with each other.
Hence, the area of the triangle is ab/2.

If only one edge of the triangle is aligned with the grid, then it must be
the hypotenuse. As the triangle is embeddable, the intersection of the two legs
must sit on the grid. Therefore, the height of the triangle with the
hypotenuse as base is integral. Hence, the area is a product of two integral
numbers divided by 2 which is rational.

If none of the edges are aligned with the grid, then for the area to be
non-rational, it must be the case that the two legs have a different square root
in them. This seems impossible. The angle between the two legs is 90 degress.
WLOG, we can assume the intersection of the two legs lie on (0, 0).
If one leg ends on (x, y), the other must end on (ay/g, -ax/g) for some integral a,
where g = gcd x y.
(sqrt (x^2 + y^2)) * (sqrt ((ay/g)^2 + (ax/g)^2))
= sqrt ((x^2 + y^2) * ((ay/g)^2 + (ax/g)^2))
= sqrt ((x^2 + y^2) * (a/g)^2 * (x^2 + y^2))
= a/g * (x^2 + y^2)
The area is the above expression divided by 2.
The expression is integral as g divides x^2 + y^2.
Hence the area is rational.

--------------------------------------------------------------------------------

Two edges case:

How many RA triangles are there on a nxn grid which satisfy the following
conditions?
1. Good
2. The legs are aligned with the grid

Let f be the function which counts such triangles on a nxn grid
which satisfy the conditions.

Base case: f 1 = 3
There are three of them. One of the vertex is the origin. Three remaining
vertices on the square. 3C2 = 3.

f 2 = f 1 + k
f 2 clearly includes f 1. f 2 is known to be 12. Hence, k = 9.

Claim:
f n = 3 * n^2

Proof:
Consider a triangle which satisfies the criteria.
Consider the triangle's minimal bounding box.
The hypotenuse of ththe triangle slices through a diagonal of the minimum
bounding box.
The three vertices of the triangle coincide with three of the four vertices of
the minimal bounding box.
By rotating the bounding box around, we can see there are three ways the
triangle can be oriented while still having a vertex on the origin.
There is exactly one rotation where the right angle lies on the origin.
Let this version of the triangle be the representative of the 3-element set
generated by rotating the triangle.

Let (x, y) encode a triangle with vertices on (0, 0), (x, 0), (0, y).
{ (x, y) | y <- { 1..n }, x <- {1..n} } has n^2 elements.
This set is in clear bijection with the representatives of the 3-element sets.
Hence, there are 3*n^2 of triangles satisfying the criteria in total.

--------------------------------------------------------------------------------

One edge case:

What are the possible lengths of the legs when the hypotenuse is aligned with
the grid?

WLOG, we can assume that the hypotenuse is parallel to x axis.
Assuming the intersection of both legs lie on (0, 0),
and OA is the edge with the smaller polar angle,
let A = (x, y) and B = (x-c, y).
The situation looks like this

      A
     / \
  a /   \ b
   /     \
  /       \
 O---------C
      c

The angle OAC is 90 degrees.

Let A = (x, y) and C = (c, 0).
We have the identity c sin^2(t) + c cos^2(t) = c, where t is the angle AOC.
a = c cos(t)
b = c sin(t)
x = a cos(t)
y = a sin(t)

x = c cos^2(t)
y = c cos(t) sin(t)

x and y are both required to be integers.
x/a = cos(t)
y/a = sin(t)

x^2 + y^2 = a^2

x = c cos^2(t), 0 < x < c
cos^2(t) = x/c
sin^2(t) = (c-x)/c
y^2 = c^2 cos^2(t) sin^2(t)
y^2 = c^2 x(c-x)/c^2
y^2 = x(c-x)

y^2 = x(c-x) for 0 < x < c
Note that if k is a solution to the equation, then so is (c-k).

--------------------------------------------------------------------------------

What are the possible lengths of the legs when none of the edges are aligned
with the grid?

An example of this would be (0, 0), (1, 1), (3, -1).
Apply the following transformations to make a vertex of the triangle lie on the
origin and to make the triangle lie within the nxn grid.

Translation             -> (-3, 1), (-2, 2), (0, 0)
Rotation by 180 degrees -> (3, -1), (2, -2), (0, 0)
Flip across x-axis      -> (3, 1), (2, 2), (0, 0)

The minimal bounding box of this triangle is [0, 3] x [0, 2].
One of the vertices of the triangle coincide with the vertices of the bounding
box.
Therefore, there is only one orientation for this triangle.

Parameterise by hypotenuse? Then each hypotenuse generate at least 2 triangles
by reflecting the other vertex across the hypotenuse?

let A = (xa, ya) and B = (xb, yb), and C = (xc, yc).
The situation looks like this

      A
     / \
  a /   \ b
   /     \
  /       \
 O---------C
      c

The angle OAC is 90 degrees.

We require the x's and the y's be larger than 0.

We will rotate the triangle such that OC is on x-axis.

c = sqrt (xc^2 + yc^2)

[ [ s, -t ]   [ xc     [ c
, [ t,  s ] ]   yc ] = , 0 ]


s*xc - t*yc = c
t*xc + s*yc = 0

t*xc + s*yc = 0
t*xc = -s*yc
t = -s*yc/xc

s*xc - t*yc = c
s*xc + s*yc^2/xc = c
s*(xc^2 + yc^2)/xc = c
s*c^2/xc = c
s = xc / c

t = -s*yc/xc
t = -yc / c

---------------
| s =  xc / c |
| t = -yc / c |
---------------


[ [ s, -t ]   [ xa     [ xa'
, [ t,  s ] ]   ya ] = , ya' ]

xa' = s*xa - t*ya
ya' = t*xa + s*ya

xa' = (xc*xa + yc*ya) / c
ya' = (-yc*xa + xc*ya) / c


The inverse to [ [ s, -t ]   is [ [  s, t ]
               , [ t,  s ] ]    , [ -t, s ] ]

[ [ s, -t ]    [ [  s, t ]
, [ t,  s ] ]  , [ -t, s ] ]

[ [ s^2 + t^2, 0         ]
, [ 0        , s^2 + t^2 ] ]
s^2 + t^2 = 1 hence it is the inverse.


We then scale up the triangle by sqrt (xc^2 + yc^2) times and find integral
solutions.

pa = c * xa'
qa = c * ya'

pa =  xc*xa + yc*ya
qa = -yc*xa + xc*ya
pc = c^2
qc = 0

(pa^2 + qa^2) + ((pc-pa)^2 + (0-qa)^2) = pc^2
(pa^2 + qa^2) + (pc^2 - 2*pc*pa + pa^2 + qa^2) = pc^2
(2*pa^2 + 2*qa^2) + (pc^2 - 2*pc*pa) = pc^2
(2*pa^2 + 2*qa^2) - 2*pc*pa = 0
pa^2 + qa^2 - pc*pa = 0
pa^2 + qa^2 - c^2*pa = 0

c worst case is sqrt (50^2 + 50^2)
c^2 worst case is 5000
The algorithm for finding solutions to pa^2 + qa^2 - c^2*pa = 0 runs in c^2 time
Which is okay.

pa^2 + qa^2 - c^2*pa = 0
qa^2 = -pa^2 + c^2*pa
qa = +- (-pa^2 + c^2*pa)

After finding solutions to pa and qa, we filter the solutions.

xa =  s*xa' + t*ya' = (s*pa + t*qa) / c
ya = -t*xa' + s*ya' = (-t*pa + s*qa) / c

s =  xc / c
t = -yc / c

xa =  s*xa + t*ya = (xc*pa - yc*qa) / c^2
ya = -t*xa + s*ya = (yc*pa + xc*qa) / c^2

(xc*pa - yc*qa) and (yc*pa + xc*qa) must be divisible by c^2


Claim:
If a good triangle has no edges aligned with the grid, then it has only one
orientation which is good.

Proof:
Consider the minimum bounding box of a good triangle which has no edges aligned
with the grid.
For each vertex of the good triangle which coincides with the vertices of
minimal bounding box, there exist a orientation of the triangle which is
good.
If we can show that there is only one coincident vertex, then we would have
proven the statement.

Aiming for a contradiction, suppose there are at least coincident two vertices.

The two coincident vertices cannot be adjacent to each other on the box as that
would mean at least one edge of the triangle is aligned with the grid.

Then the two coincident vertices must be diagonally opposite on the box.
That cannot be the case either.
There are two RA triangles which lie within the bounding box,
(0, 0), (xc, yc), (0, yc) and (0, 0), (xc, yc), (xc, 0)
We will show there are no other RA triangle which satifies the following
criteria.
1. Lies within the minimal bounding box.
2. Two vertices are (0, 0) and (xc, yc)

The two vertices (0, 0) and (xc, yc) are coincident with the bounding box.
The longest line segment which lies within the minimal bounding box is the
diagonal, i.e. (0, 0) to (xc, yc).
This line segement must be the hypotenuse of any triangle satisfying the
criteria as this is the longest line segment within the bounding box.
Now the hypotenuse is fixed, a triangle must lie completely within the top half
of the bounding box or the bottom half of the bounding box, split by the
hypotenuse line segment.
If we can show there is no RA triangle strictly within the triangle
(0, 0), (xc, yc), (0, yc), then by symmetry we can extend the proof to the
other half of the bounding box and conclude there are no other RA triangles
which satisfy the criteria.
Geometrically this is obvious.
Any RA triangle with a hypotenuse of length l must have one vertex lying on
the circumference of a circle of diameter l, with the other two vertices
lying on the two ends of the diameter.
If there exist another triangle satisfying the criteria, then one of the vertex
must lie simutaneously on the circumference of circle and strictly within the
(0, 0), (xc, yc), (0, yc) triangle.
This is clearly impossible.
Hence, it cannot be the case that there are at least two coincident vertices.

TODO Proof that the four orientation of bounding box corresponds to the only
four possible orientation of triangles.

Therefore, there is only one coincident vertex and only one orientation for
good triangles with no edges aligned with the grid.

--------------------------------------------------------------------------------

By translating A to origin, rotate AO by 90 deg, scale AO, translate back.
Does not seem promising.

Working in affine space, we have the following translation matrix.
[ [ 1, 0, -xa ]
, [ 0, 1, -ya ]
, [ 0, 0,  1  ]
]
This matrix translate vectors by (-xa, -ya).


Then we have the rotation matrix.
[ [ 0, -1, 0 ]
, [ 1,  0, 0 ]
, [ 0,  0, 1 ]
]

Then we scale the vector by k.

[ [ k, 0, 0 ]
, [ 0, k, 0 ]
, [ 0, 0, 1 ]
]

Finally, we translate back.
[ [ 1, 0, xa ]
, [ 0, 1, ya ]
, [ 0, 0, 1  ]
]

T_A . Sk . R90 . T_(-A)

[ [ 1, -k,  k*ya + xa ]
, [ k,  0, -k*xa + ya ]
, [ 0,  0,  1         ]
]

-A = (-xa, -ya)

(T_A . Sk . R90 . T_(-A)) (-A)

[  2*k*ya + xa
, -2*k*xa + ya
,  1           ]

C = (2*k*ya + xa, -2*k*xa + ya)
 2*k*ya + xa = xc
-2*k*xa + ya = yc
3 variables, 2 equation.



C = (2*k*ya + xa, -2*k*xa + ya)
2*k*ya + xa and -2*k*xa + ya must be both integral.
k must be a multiple of 1/(2g), where g = gcd xa xb, and 1/(2g) is the smallest
possible increment.
Therefore, write C = (k/g*ya + xa, -k/g*xa + ya)

--------------------------------------------------------------------------------

